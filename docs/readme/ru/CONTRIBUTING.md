# Гайд по вкладу в RimLoc

[English version](../../CONTRIBUTING.md)

Спасибо за желание улучшить RimLoc! Эта инструкция поможет настроить окружение, следовать правилам проекта и подготовить изменения так, чтобы их было просто проверить и влить.

## Чек-лист быстрого старта
- Сделайте форк репозитория и создайте тематическую ветку от `main`.
- Установите актуальный стабильный Rust через [rustup](https://rustup.rs/) и убедитесь, что `cargo` доступен в PATH.
- Выполните полную сборку и тесты: `cargo build --workspace` и `cargo test --workspace`.
- Перед коммитом запускайте `cargo fmt` и `cargo clippy --workspace --all-targets -- -D warnings`.
- Используйте Conventional Commits в формате `type(scope): summary` по шаблону из `.gitmessage.txt`.
- Открывайте pull request с понятным описанием, шагами валидации и скриншотами/выводом CLI, если меняется поведение.

## Рабочее окружение
- **Rust**: проект использует стабильный Rust (Edition 2021). Поддерживайте toolchain в актуальном состоянии (`rustup update`).
- **Дополнительные утилиты**: `cargo install cargo-watch` пригодится для автопересборки, но не обязателен. `just` и `make` не используются.
- **GUI-эксперименты**: экспериментальный десктоп на Tauri лежит в `gui/tauri-app`. Если планируете с ним работать, выполните требования Tauri для вашей платформы.
- **Документация на Python**: сайт документации находится в `docs/` и собирается MkDocs. Создайте виртуальное окружение (`python -m venv .venv`), активируйте его, установите зависимости из `requirements-docs.txt`, затем запустите `mkdocs serve` для локального просмотра.

## Структура репозитория
- `crates/` — участники Cargo workspace.
  - `rimloc-core` — базовая логика перевода и валидации.
  - `rimloc-parsers-xml` — утилиты разбора XML.
  - `rimloc-export-*` / `rimloc-import-*` — экспортёры и импортёры PO/CSV.
  - `rimloc-cli` — точка входа CLI.
  - `rimloc-validate` — общие проверки и валидаторы.
- `test/` — фикстуры для интеграционных тестов и ручных проверок.
- `docs/` — исходники сайта документации MkDocs.
- `gui/tauri-app` — экспериментальная оболочка рабочего стола.
- `target/` — выходные артефакты сборки (не коммитим).

## Сборка и тестирование
- Полная сборка: `cargo build --workspace`.
- Полный набор тестов: `cargo test --workspace` (добавьте `-- --nocapture`, чтобы увидеть stdout).
- Быстрая проверка CLI: `cargo run -p rimloc-cli -- scan --root test/TestMod` — прогон по встроенным фикстурам.
- Точечные тесты: `cargo test --package <crate>` или `cargo test --features <feature>` для функциональности за флагами.
- Добавляя новую логику, пишите unit-тесты рядом с кодом и обновляйте интеграционные тесты в `crates/rimloc-cli/tests`, используя хелперы из `helpers.rs`.
- Для временных файлов применяйте `tempfile`, долгоживущие фикстуры храните в `test/`.

## Стандарты кодирования
- Форматирование: обязательно `cargo fmt`; не правьте стиль вручную.
- Линтинг: `cargo clippy --workspace --all-targets -- -D warnings` должен проходить без предупреждений.
- Нейминг: модули/файлы/функции — `snake_case`, структуры/enum — `PascalCase`, константы — `SCREAMING_SNAKE_CASE`, CLI-флаги — kebab-case.
- Логирование: используем `tracing`; в библиотечном коде избегаем `println!`.
- Обработка ошибок: в бинарях применяем `anyhow`, в библиотеках — `thiserror` для типизированных ошибок.

## Локализация
- Английский файл Fluent (`crates/rimloc-cli/i18n/en/rimloc.ftl`) — источник истины.
- Сначала обновляйте английский, затем синхронно другие локали в той же структуре.
- Для проверки ключей запускайте `cargo test --package rimloc-cli -- tests_i18n` (или `cargo i18n`, если установлен).
- Имена ключей — строчные с дефисами. Новые строки описывайте в PR, чтобы переводчикам было проще.

## Обновление документации
- Обновляйте встроенные `//!` и doc-комментарии вместе с кодом.
- Для сайта `docs/` пишите Markdown под MkDocs. Предпросмотр: `mkdocs serve` (только после активации `.venv`).
- В репозиторий попадают только подготовленные материалы; `site/` и `target/` остаются в `.gitignore`.

## Отправка изменений
1. Делайте небольшие, понятные коммиты по шаблону `.gitmessage.txt`.
2. Перед PR ребейзитесь на `main`, чтобы избежать конфликтов.
3. В описании PR укажите:
   - что изменилось и почему;
   - как проверяли (команды, тесты, скриншоты);
   - последующие шаги или ограничения, если есть.
4. Убедитесь, что CI зелёный (build, lint, тесты, docs при необходимости).
5. На ревью отвечайте уважительно и предметно; правки вносите оперативно.

## Политики репозитория

### Политика рамок коммита (обязательно)
- Коммитьте только те файлы, которые намеренно редактировались в рамках задачи. Не включайте несвязанные изменения.
- Не делайте «проездом» массовые рефакторинги/переименования/переформатирование по всему репозиторию. Держите диффы минимальными и сфокусированными.
- Запускайте `cargo fmt`, но в коммит добавляйте только действительно затронутые файлы. Если нужна тотальная переформатировка — вынесите её в отдельный PR.
- Не меняйте версии, структуру модулей и сгенерированные артефакты, если это не часть задачи.

### Политика запрета ревёртов (обязательно)
- Не откатывайте и не удаляйте изменения без явного согласия автора/мейнтейнера.
- Исключения: только если это строго необходимо, чтобы починить упавшую сборку/тесты или завершить текущую фичу/фикс. Обязательно укажите причину в теле коммита.
- Если встретились несвязанные незакоммиченные локальные изменения — спросите, что с ними делать (сохранить/закоммитить/удалить). Не откатывайте их молча.
- Если ревёрт необходим, оформляйте отдельным коммитом со ссылкой на исходное изменение (например, `revert: <hash> <subject>`). Не смешивайте ревёрт с функциональными правками.

## Сообщения об ошибках и запросы фич
- Создавайте GitHub Issue с чёткими шагами воспроизведения, ожидаемым/фактическим результатом и данными окружения.
- Для проблем локализации обязательно указывайте язык и пример строки.
- Уязвимости безопасности сообщайте приватно владельцу репозитория (контакты в профиле GitHub).

## Нужна помощь?
Если застряли:
- Проверьте существующие issue и обсуждения.
- Загляните в `AGENTS.md` за правилами для автоматизации.
- Откройте черновой PR, чтобы получить ранний фидбек.
- Напишите в обсуждения GitHub или другие указанные каналы сообщества.

Спасибо, что помогаете развивать RimLoc!
