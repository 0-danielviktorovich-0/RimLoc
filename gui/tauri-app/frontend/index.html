<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RimLoc GUI</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="overlay" class="overlay hidden">
      <div class="overlay-card">
        <div class="spinner" aria-hidden="true"></div>
        <p id="overlay-text">Working…</p>
      </div>
    </div>
    <div id="toast" role="status" aria-live="polite"></div>

    <header>
      <div>
        <h1 data-i18n="title">RimLoc GUI</h1>
        <p class="subtitle" data-i18n="subtitle">Desktop companion for RimLoc services</p>
      </div>
      <div class="header-meta">
        <span id="app-version"></span>
        <span id="status-text"></span>
      </div>
    </header>

    <main>
      <section class="panel" id="progress-panel">
        <div class="panel-head">
          <h2 data-i18n="progress">Progress</h2>
        </div>
        <div id="progress-items" class="progress-items"></div>
      </section>
      <section class="panel" id="settings-panel">
        <div class="panel-head">
          <h2 data-i18n="settings">Settings</h2>
          <div class="actions">
            <button id="open-debug-modal" type="button" data-i18n="open_debug">Debug…</button>
          </div>
        </div>
        <div class="field-grid">
          <label>
            <span data-i18n="language">Language</span>
            <select id="locale-select">
              <option value="auto" data-i18n="lang.auto">Auto</option>
              <option value="en">English</option>
              <option value="ru">Русский</option>
            </select>
          </label>
          <label>
            <span data-i18n="theme">Theme</span>
            <select id="theme-select">
              <option value="auto" data-i18n="theme.auto">Auto</option>
              <option value="light" data-i18n="theme.light">Light</option>
              <option value="dark" data-i18n="theme.dark">Dark</option>
            </select>
          </label>
          <label>
            <span data-i18n="loglevel">Log level</span>
            <select id="log-level">
              <option value="info">info</option>
              <option value="debug">debug</option>
            </select>
          </label>
        </div>
      </section>
      <section class="panel" id="mod-setup">
        <h2 data-i18n="mod_setup">Mod setup</h2>
        <p class="hint" data-i18n="mod_setup_hint">Choose the mod folder and optional game version. Values are stored locally for convenience.</p>
        <div class="field-group">
          <label for="mod-root" data-i18n="mod_root">Mod root</label>
          <div class="path-input">
            <input id="mod-root" type="text" placeholder="/path/to/mod" autocomplete="off" />
            <button type="button" data-action="pick-root" data-i18n="browse">Browse…</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="game_version">Game version (optional)
            <input id="game-version" type="text" placeholder="e.g. 1.5" autocomplete="off" />
          </label>
          <label data-i18n="target_lang">Target language code
            <input id="target-lang" type="text" placeholder="ru" autocomplete="off" />
          </label>
          <label data-i18n="source_lang">Source language code
            <input id="source-lang" type="text" placeholder="auto" autocomplete="off" />
          </label>
        </div>
      </section>

      <section class="panel" id="scan-panel">
        <div class="panel-head">
          <h2 data-i18n="scan_title">Scan Keyed &amp; DefInjected</h2>
          <div class="actions">
            <button type="button" id="scan-run" data-i18n="scan_run">Run scan</button>
            <button type="button" id="scan-save-json" data-i18n="scan_save_json">Save JSON…</button>
            <button type="button" id="scan-save-csv" data-i18n="scan_save_csv">Save CSV…</button>
          </div>
        </div>
        <div class="field-grid">
          <label>
            <input id="scan-all-versions" type="checkbox" />
            <span data-i18n="scan_all_versions">Include all versions under root</span>
          </label>
        </div>
        <div class="scan-summary" id="scan-summary" data-i18n="scan_empty">No scan performed yet.</div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th scope="col" data-i18n="th_key">Key</th>
                <th scope="col" data-i18n="th_kind">Kind</th>
                <th scope="col" data-i18n="th_source">Source sample</th>
                <th scope="col" data-i18n="th_path">Path</th>
                <th scope="col" data-i18n="th_line">Line</th>
              </tr>
            </thead>
            <tbody id="scan-table-body"></tbody>
          </table>
        </div>
      </section>

      <section class="panel" id="learn-panel">
        <div class="panel-head">
          <h2 data-i18n="learn_title">Learn DefInjected</h2>
          <div class="actions">
            <button type="button" id="learn-run" data-i18n="learn_run">Learn defs</button>
            <button type="button" id="learn-open-out" disabled data-i18n="open_output">Open output</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="out_folder">Output folder
            <div class="path-input">
              <input id="learn-out" type="text" placeholder="_learn" autocomplete="off" />
              <button type="button" data-action="pick-learn-out" data-i18n="browse">Browse…</button>
            </div>
          </label>
          <label data-i18n="source_lang_folder">Source language folder
            <input id="learn-lang-dir" type="text" placeholder="English" autocomplete="off" />
          </label>
        </div>
        <div class="result" id="learn-result" data-i18n="learn_empty">No learn run yet.</div>
      </section>

      <section class="panel" id="export-panel">
        <div class="panel-head">
          <h2 data-i18n="export_title">Export PO</h2>
          <div class="actions">
            <button type="button" id="export-run" data-i18n="export_run">Export PO</button>
            <button type="button" id="export-open-file" disabled data-i18n="open_file">Open file</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="po_out_file">PO output file
            <div class="path-input">
              <input id="po-output" type="text" placeholder="_learn/mod.po" autocomplete="off" />
              <button type="button" data-action="pick-po-output" data-i18n="browse">Browse…</button>
            </div>
          </label>
          <label data-i18n="tm_folders">Translation memory folders (one per line)
            <textarea id="tm-roots" rows="3" placeholder="/path/to/reference-mod"></textarea>
          </label>
          <label data-i18n="source_lang_folder">Source language folder
            <input id="export-source-lang-dir" type="text" placeholder="English" autocomplete="off" />
          </label>
        </div>
        <div class="result" id="export-result" data-i18n="export_empty">No export performed yet.</div>
      </section>

      <section class="panel" id="validate-panel">
        <div class="panel-head">
          <h2 data-i18n="validate_title">Validate</h2>
          <div class="actions">
            <button type="button" id="validate-run" data-i18n="validate_run">Run validate</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="source_lang">Source language code
            <input id="validate-source-lang" type="text" placeholder="auto" autocomplete="off" />
          </label>
          <label data-i18n="source_lang_folder">Source language folder
            <input id="validate-source-lang-dir" type="text" placeholder="English" autocomplete="off" />
          </label>
          <label data-i18n="defs_root">Defs root (optional)
            <div class="path-input">
              <input id="validate-defs-root" type="text" placeholder="/path/to/Defs" autocomplete="off" />
              <button type="button" data-action="pick-validate-defs" data-i18n="browse">Browse…</button>
            </div>
          </label>
          <label data-i18n="extra_fields">Extra fields (comma-separated)
            <input id="validate-extra-fields" type="text" placeholder="label,description" autocomplete="off" />
          </label>
        </div>
        <div class="result" id="validate-result" data-i18n="validate_empty">No validation run yet.</div>
      </section>

      <section class="panel" id="health-panel">
        <div class="panel-head">
          <h2 data-i18n="health_title">XML Health</h2>
          <div class="actions">
            <button type="button" id="health-run" data-i18n="health_run">Check</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="source_lang_folder">Source language folder
            <input id="health-lang-dir" type="text" placeholder="English" autocomplete="off" />
          </label>
        </div>
        <div class="result" id="health-result" data-i18n="health_empty">No health check yet.</div>
      </section>

      <section class="panel" id="import-panel">
        <div class="panel-head">
          <h2 data-i18n="import_title">Import PO → XML</h2>
          <div class="actions">
            <button type="button" id="import-run" data-i18n="import_run">Import PO</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="po_file">PO file
            <div class="path-input">
              <input id="import-po" type="text" placeholder="/path/to/translation.po" autocomplete="off" />
              <button type="button" data-action="pick-import-po" data-i18n="browse">Browse…</button>
            </div>
          </label>
          <label data-i18n="target_lang_folder">Target language folder
            <input id="import-lang-dir" type="text" placeholder="Russian" autocomplete="off" />
          </label>
          <label>
            <input id="import-single-file" type="checkbox" />
            <span data-i18n="import_single_file">Single file (_Imported.xml)</span>
          </label>
          <label>
            <input id="import-incremental" type="checkbox" />
            <span data-i18n="import_incremental">Incremental (skip identical)</span>
          </label>
          <label>
            <input id="import-keep-empty" type="checkbox" />
            <span data-i18n="import_keep_empty">Keep empty entries</span>
          </label>
        </div>
        <div class="result" id="import-result" data-i18n="import_empty">No import performed yet.</div>
      </section>

      <section class="panel" id="build-panel">
        <div class="panel-head">
          <h2 data-i18n="build_title">Build Translation Mod</h2>
          <div class="actions">
            <button type="button" id="build-run" data-i18n="build_run">Build</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="po_file">PO file
            <div class="path-input">
              <input id="build-po" type="text" placeholder="/path/to/translation.po" autocomplete="off" />
              <button type="button" data-action="pick-build-po" data-i18n="browse">Browse…</button>
            </div>
          </label>
          <label data-i18n="out_folder">Output folder
            <div class="path-input">
              <input id="build-out" type="text" placeholder="/path/to/mod-out" autocomplete="off" />
              <button type="button" data-action="pick-build-out" data-i18n="browse">Browse…</button>
            </div>
          </label>
          <label data-i18n="target_lang_folder">Target language folder
            <input id="build-lang-dir" type="text" placeholder="Russian" autocomplete="off" />
          </label>
          <label>
            <span data-i18n="mod_name">Mod name</span>
            <input id="build-name" type="text" placeholder="RimLoc Translation" autocomplete="off" />
          </label>
          <label>
            <span data-i18n="package_id">Package ID</span>
            <input id="build-package" type="text" placeholder="your.name.rimloc" autocomplete="off" />
          </label>
          <label>
            <span data-i18n="rw_version">RimWorld version</span>
            <input id="build-rw" type="text" placeholder="1.5" autocomplete="off" />
          </label>
          <label>
            <input id="build-dedupe" type="checkbox" />
            <span data-i18n="build_dedupe">Dedupe keys</span>
          </label>
        </div>
        <div class="result" id="build-result" data-i18n="build_empty">No build performed yet.</div>
      </section>

      <section class="panel" id="diff-panel">
        <div class="panel-head">
          <h2 data-i18n="diff_title">Diff XML</h2>
          <div class="actions">
            <button type="button" id="diff-run" data-i18n="diff_run">Run diff</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="source_lang_folder">Source language folder
            <input id="diff-source-lang-dir" type="text" placeholder="English" autocomplete="off" />
          </label>
          <label data-i18n="target_lang_folder">Target language folder
            <input id="diff-target-lang-dir" type="text" placeholder="Russian" autocomplete="off" />
          </label>
          <label data-i18n="defs_root">Defs root (optional)
            <div class="path-input">
              <input id="diff-defs-root" type="text" placeholder="/path/to/Defs" autocomplete="off" />
              <button type="button" data-action="pick-diff-defs" data-i18n="browse">Browse…</button>
            </div>
          </label>
          <label data-i18n="po_file">Baseline PO (optional)
            <div class="path-input">
              <input id="diff-po" type="text" placeholder="/path/to/baseline.po" autocomplete="off" />
              <button type="button" data-action="pick-diff-po" data-i18n="browse">Browse…</button>
            </div>
          </label>
        </div>
        <div class="result" id="diff-result" data-i18n="diff_empty">No diff run yet.</div>
      </section>

      <section class="panel" id="lang-update-panel">
        <div class="panel-head">
          <h2 data-i18n="lang_update_title">Lang Update</h2>
          <div class="actions">
            <button type="button" id="lang-update-run" data-i18n="lang_update_run">Update</button>
          </div>
        </div>
        <div class="field-grid">
          <label>Repo
            <input id="lang-update-repo" type="text" placeholder="Ludeon/RimWorld" autocomplete="off" />
          </label>
          <label>Branch
            <input id="lang-update-branch" type="text" placeholder="master" autocomplete="off" />
          </label>
          <label data-i18n="source_lang_folder">Source language folder
            <input id="lang-update-source" type="text" placeholder="English" autocomplete="off" />
          </label>
          <label data-i18n="target_lang_folder">Target language folder
            <input id="lang-update-target" type="text" placeholder="Russian" autocomplete="off" />
          </label>
          <label>
            <input id="lang-update-dry" type="checkbox" />
            <span data-i18n="dry_run">Dry run</span>
          </label>
          <label>
            <input id="lang-update-backup" type="checkbox" />
            <span data-i18n="backup">Backup existing</span>
          </label>
        </div>
        <div class="result" id="lang-update-result" data-i18n="lang_update_empty">No lang update yet.</div>
      </section>

      <section class="panel" id="annotate-panel">
        <div class="panel-head">
          <h2 data-i18n="annotate_title">Annotate Keyed</h2>
          <div class="actions">
            <button type="button" id="annotate-preview" data-i18n="annotate_preview">Preview</button>
            <button type="button" id="annotate-apply" data-i18n="annotate_apply">Apply</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="source_lang_folder">Source language folder
            <input id="annotate-source" type="text" placeholder="English" autocomplete="off" />
          </label>
          <label data-i18n="target_lang_folder">Target language folder
            <input id="annotate-target" type="text" placeholder="Russian" autocomplete="off" />
          </label>
          <label>
            <span>Prefix</span>
            <input id="annotate-prefix" type="text" placeholder="//" autocomplete="off" />
          </label>
          <label>
            <input id="annotate-strip" type="checkbox" />
            <span data-i18n="strip_comments">Strip existing comments</span>
          </label>
          <label>
            <input id="annotate-backup" type="checkbox" />
            <span data-i18n="backup">Backup files</span>
          </label>
        </div>
        <div class="result" id="annotate-result" data-i18n="annotate_empty">No annotate yet.</div>
      </section>

      <section class="panel" id="init-panel">
        <div class="panel-head">
          <h2 data-i18n="init_title">Init Language</h2>
          <div class="actions">
            <button type="button" id="init-run" data-i18n="init_run">Init</button>
          </div>
        </div>
        <div class="field-grid">
          <label data-i18n="source_lang_folder">Source language folder
            <input id="init-source" type="text" placeholder="English" autocomplete="off" />
          </label>
          <label data-i18n="target_lang_folder">Target language folder
            <input id="init-target" type="text" placeholder="Russian" autocomplete="off" />
          </label>
          <label>
            <input id="init-overwrite" type="checkbox" />
            <span data-i18n="overwrite">Overwrite existing</span>
          </label>
          <label>
            <input id="init-dry" type="checkbox" />
            <span data-i18n="dry_run">Dry run</span>
          </label>
        </div>
        <div class="result" id="init-result" data-i18n="init_empty">No init yet.</div>
      </section>

      <section class="panel" id="debug-panel">
        <div class="panel-head">
          <h2 data-i18n="debug_console">Debug console</h2>
          <div class="actions">
            <button type="button" id="debug-clear" data-i18n="clear">Clear</button>
          </div>
        </div>
        <pre id="debug-log" class="debug-log" aria-live="polite"></pre>
      </section>

      <div id="debug-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="debug-modal-title">
        <div class="modal-card">
          <div class="modal-head">
            <h3 id="debug-modal-title" data-i18n="debug_modal_title">Diagnostics</h3>
            <button type="button" id="debug-modal-close">✕</button>
          </div>
          <div class="modal-body">
            <p data-i18n="debug_modal_hint">Copy errors or share with maintainer. Log file:</p>
            <div class="path-row">
              <code id="log-path">…</code>
              <div class="path-actions">
                <button id="copy-log-path" type="button" data-i18n="copy">Copy</button>
                <button id="open-log-folder" type="button" data-i18n="open_folder">Open folder</button>
                <button id="save-console" type="button" data-i18n="save_console">Save console…</button>
              </div>
            </div>
            <pre id="debug-modal-content" class="debug-log"></pre>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p data-i18n="footer_hint">Need DefInjected strings? Run “Learn defs” first and copy <code>suggested.xml</code> into your language folder.</p>
    </footer>

    <script src="tauri.js"></script>
    <script src="index.js"></script>
  </body>
</html>
